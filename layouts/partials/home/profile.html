{{- $profile := .Site.Params.home.profile -}}
<div class="home-profile">
    {{- $avatar := $profile.avatarURL -}}
    {{- with $profile.gravatarEmail -}}
        {{- $avatar = md5 . | printf "https://www.gravatar.com/avatar/%v?s=240&d=mp" -}}
    {{- end -}}
    {{- if $avatar -}}
        <div class="home-avatar">
            {{- $menus := $.Site.Menus.main | default slice -}}
            {{- with index $menus 0 -}}
                {{- $url := .URL | relLangURL -}}
                {{- with .Page -}}
                    {{- $url = .RelPermalink -}}
                {{- end -}}
                <a href="{{ $url }}"{{ with .Title | default .Name }} title="{{ . }}"{{ end }}{{ if (urls.Parse $url).Host }} rel="noopener noreffer" target="_blank"{{ end }}>
                    {{- dict "Src" $avatar | partial "plugin/img.html" -}}
                </a>
            {{- else -}}
                {{- dict "Src" $avatar | partial "plugin/img.html" -}}
            {{- end -}}
        </div>
    {{- end -}}

    {{- with $profile.title -}}
        <h1 class="home-title">
            {{- . | safeHTML -}}
        </h1>
    {{- end -}}

    {{- /* Custom animated subtitle with emoji cycle */ -}}
    <div class="home-subtitle">
        <div id="custom-typeit" style="display: inline-block; min-height: 1.5em;"></div>
        <span id="custom-cursor" style="display: inline-block; animation: blink 1s step-end infinite;">|</span>
    </div>

    <style>
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        #custom-typeit {
            font-size: inherit;
            line-height: inherit;
        }
    </style>

    <script>
    (function() {
        var el = document.getElementById('custom-typeit');
        var cursor = document.getElementById('custom-cursor');
        var baseText = "Welcome to OkongOyangO's PhysHub";
        var emojis = [
            "\uD83D\uDD34", // ðŸ”´
            "\uD83D\uDFE0", // ðŸŸ 
            "\uD83D\uDFE1", // ðŸŸ¡
            "\uD83D\uDFE2", // ðŸŸ¢
            "\uD83D\uDD35", // ðŸ”µ
            "\uD83D\uDFE3", // ðŸŸ£
            "\uD83D\uDFE4", // ðŸŸ¤
            "\u26AB",       // âš«
            "\u26AA",       // âšª
            "\uD83D\uDE0E"  // ðŸ˜Ž
        ];
        var typeSpeed = 80;
        var emojiInterval = 300;
        var restartDelay = 30000;
        var timer = null;

        function typeText(text, callback) {
            var i = 0;
            function next() {
                if (i <= text.length) {
                    el.textContent = text.substring(0, i);
                    i++;
                    setTimeout(next, typeSpeed);
                } else {
                    callback();
                }
            }
            next();
        }

        function cycleEmojis(callback) {
            var i = 0;
            function next() {
                if (i < emojis.length) {
                    var emoji = emojis[i];
                    el.textContent = emoji + baseText + emoji;
                    i++;
                    if (i < emojis.length) {
                        setTimeout(next, emojiInterval);
                    } else {
                        // Last emoji (ðŸ˜Ž) â€” stay here
                        cursor.style.display = 'none';
                        callback();
                    }
                }
            }
            next();
        }

        function clearText(callback) {
            var text = el.textContent;
            cursor.style.display = 'inline-block';
            function next() {
                if (text.length > 0) {
                    // Remove characters from end (handle surrogate pairs)
                    var arr = Array.from(text);
                    arr.pop();
                    text = arr.join('');
                    el.textContent = text;
                    setTimeout(next, 30);
                } else {
                    callback();
                }
            }
            next();
        }

        function runAnimation() {
            el.textContent = '';
            cursor.style.display = 'inline-block';
            typeText(baseText, function() {
                setTimeout(function() {
                    cycleEmojis(function() {
                        timer = setTimeout(function() {
                            clearText(function() {
                                runAnimation();
                            });
                        }, restartDelay);
                    });
                }, 500);
            });
        }

        // Wait for DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runAnimation);
        } else {
            runAnimation();
        }
    })();
    </script>

    {{- if $profile.social -}}
        <div class="links">
            {{- $socialMap := resources.Get "data/social.yml" | transform.Unmarshal -}}
            {{- $socialArr := slice -}}
            {{- range $key, $value := .Site.Params.social -}}
                {{- $social := $key | lower | index $socialMap | default dict -}}
                {{- with $social.Alias -}}
                    {{- $social = index $socialMap . | default dict -}}
                {{- end -}}
                {{- if $value -}}
                    {{- if reflect.IsMap $value -}}
                        {{- with $value.weight -}}
                            {{- $social = dict "Weight" . | merge $social -}}
                        {{- end -}}
                        {{- with $value.prefix -}}
                            {{- $social = dict "Prefix" . | merge $social -}}
                        {{- end -}}
                        {{- with index $value "template" -}}
                            {{- $social = dict "Template" . | merge $social -}}
                        {{- end -}}
                        {{- with $value.id -}}
                            {{- $social = dict "Id" . | merge $social -}}
                        {{- end -}}
                        {{- with $value.url -}}
                            {{- $social = dict "Url" . | merge $social -}}
                        {{- end -}}
                        {{- with $value.title -}}
                            {{- $social = dict "Title" . | merge $social -}}
                        {{- end -}}
                        {{- with $value.newtab -}}
                            {{- $social = dict "Newtab" . | merge $social -}}
                        {{- end -}}
                        {{- with $value.icon -}}
                            {{- $social = dict "Icon" . | merge $social -}}
                        {{- end -}}
                        {{- with $value.rel -}}
                            {{- $social = dict "Rel" . | merge $social -}}
                        {{- end -}}
                    {{- else if ne $value true -}}
                        {{- $social = dict "Id" $value | merge $social -}}
                    {{- end -}}
                    {{- if $social.Icon.Simpleicons -}}
                        {{- $prefix := ($.Scratch.Get "cdn" | default dict).simpleIconsPrefix -}}
                        {{- $social = dict "Prefix" $prefix | dict "Icon" | merge $social -}}
                    {{- end -}}
                    {{- $socialArr = $socialArr | append $social -}}
                {{- end -}}
            {{- end -}}
            {{- range sort $socialArr "Weight" -}}
                {{- partial "plugin/social.html" . -}}
            {{- end -}}
            {{- /* Like this site - star on GitHub */ -}}
            <a href="https://github.com/OkongOyangO/OkongOyangO.Notes" title="Like this site? Star on GitHub!" target="_blank" rel="noopener noreffer me"><i class="fas fa-heart fa-fw" aria-hidden="true"></i></a>
        </div>
    {{- end -}}

    {{- with $profile.disclaimer -}}
        <h3 class="home-disclaimer">
            {{- . | safeHTML -}}
        </h3>
    {{- end -}}
</div>
